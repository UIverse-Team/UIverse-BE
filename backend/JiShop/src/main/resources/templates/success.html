<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <link rel="icon" href="https://static.toss.im/icons/png/4x/icon-toss-logo.png" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>í† ìŠ¤í˜ì´ë¨¼ì¸  ìƒ˜í”Œ í”„ë¡œì íŠ¸</title>
    <link rel="stylesheet" th:href="@{/css/payment.css}" />
</head>

<body>
<div class="wrapper w-100">
    <!-- ê²°ì œ ìŠ¹ì¸ ì „ í™”ë©´ -->
    <div class="flex-column align-center confirm-loading w-100 max-w-540">
        <div class="flex-column align-center">
            <img src="https://static.toss.im/lotties/loading-spot-apng.png" width="120" height="120" />
            <h2 class="title text-center">ê²°ì œ ìš”ì²­ê¹Œì§€ ì„±ê³µí–ˆì–´ìš”.</h2>
            <h4 class="text-center description">ê²°ì œ ìŠ¹ì¸í•˜ê³  ì™„ë£Œí•´ë³´ì„¸ìš”.</h4>
        </div>
        <div class="w-100">
            <button id="confirmPaymentButton" class="btn primary w-100">ê²°ì œ ìŠ¹ì¸í•˜ê¸°</button>
        </div>
    </div>

    <!-- ê²°ì œ ìŠ¹ì¸ í›„ í™”ë©´ -->
    <div class="flex-column align-center confirm-success w-100 max-w-540" style="display: none;">
        <img src="https://static.toss.im/illusts/check-blue-spot-ending-frame.png" width="120" height="120" />
        <h2 class="title">ê²°ì œë¥¼ ì™„ë£Œí–ˆì–´ìš”</h2>

        <div class="response-section w-100">
            <div class="flex justify-between">
                <span class="response-label">ê²°ì œ ê¸ˆì•¡</span>
                <span id="amount" class="response-text" th:text="${amount} + 'ì›'"></span>
            </div>
            <div class="flex justify-between">
                <span class="response-label">ì£¼ë¬¸ë²ˆí˜¸</span>
                <span id="orderId" class="response-text" th:text="${orderId}"></span>
            </div>
            <div class="flex justify-between">
                <span class="response-label">paymentKey</span>
                <span id="paymentKey" class="response-text" th:text="${paymentKey}"></span>
            </div>
        </div>
<!--        <div class="w-100 button-group">-->
<!--            <div class="flex" style="gap: 16px;">-->
<!--                <a class="btn w-100" href="https://developers.tosspayments.com/sandbox">ë‹¤ì‹œ í…ŒìŠ¤íŠ¸í•˜ê¸°</a>-->
<!--                <a class="btn w-100" href="https://docs.tosspayments.com/guides/v2/payment-widget/integration" target="_blank" rel="noreferrer noopener">ê²°ì œ ì—°ë™ ë¬¸ì„œê°€ê¸°</a>-->
<!--            </div>-->
<!--        </div>-->
    </div>
</div>

<script type="module">
    // ğŸ’¡ Thymeleaf ë³€ìˆ˜ ë¬¸ìì—´ ì²˜ë¦¬
    const paymentKey = '[[${paymentKey}]]';
    const orderId = '[[${orderId}]]';
    const amount = [[${amount}]];

    const confirmLoadingSection = document.querySelector('.confirm-loading');
    const confirmSuccessSection = document.querySelector('.confirm-success');

    async function confirmPayment() {
        const response = await fetch('/payments/confirm', { // âœ… ì‹¤ì œ API ê²½ë¡œë¡œ ìˆ˜ì •ë¨
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                paymentKey,
                orderId,
                amount
            }),
        });

        if (response.ok) {
            confirmLoadingSection.style.display = 'none';
            confirmSuccessSection.style.display = 'flex';
        } else {
            alert("âŒ ê²°ì œ ìŠ¹ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
    }

    document.getElementById('confirmPaymentButton')
        .addEventListener('click', confirmPayment);
</script>
</body>
</html>
